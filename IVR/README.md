# IVR 入门

接收电话呼入，并接收按键码，然后进行一次外呼，并连接连个通话。

<!-- toc -->

----

## ONEYUN IVR XML
IVR 即交互式声音应答。

ONEYUN 的 IVR 接口是回调接口，也就是说，用户需要提供一个 HTTP URL 来接受来自 oneyun 的 IVR 回调请求，该 URL 在用户中心设置。

在收到 IVR 的HTTP回调请求后，用户的应用服务要返回一段用 XML 表诉的 IVR 动作，如放音、录音等。

除了挂断(`<hangup>`)之外，所有的 IVR 动作都必须和 `<next>` 标签组合使用。
平台在执行完一个 IVR 动作之后，就会向 `<next>` 的内容部分所定义的 URL 地址发送一次 HTTP 请求。
在这次请求中，包括了动作节点的输出参数和 `<next>` 的 `tag` 值。

## 与您的应用交互
您需要一个 Internet 上的 Web 服务器，在服务器上运行您的 Web 服务程序，它可以是 `Tomcat + java`, `Apache Httpd + Php`, `Nginx + Ruby` ……
无论哪种服务器还是语言，您需要让它响应 IVR 回调，并返回 ONEYUN IVR XML。

下文中，应用服务器指方开发者的Web服务器。

## 构建一个 `Hello` 程序
下面，我们将构建一个IVR例子程序，它的工作步骤是：

1. [准备工作](1-prepare.md)
2. [响应电话呼入](2-call_in.md)
3. [放音](3-play.md)
4. [接收按键码输入](4-input.md)
5. [外呼拨号](5-dial.md)

## IVR动作分解

`Hello`程序的处理流程可以这样分解：

1. 用户呼叫IVR号码->平台请求应用服务器-->应用服务器的`第一步处理器`，返回`收码`动作(给用户播放欢迎或引导音，并收码)
2. 用户在手机输入按键码1，查询最新优惠->平台收码完成，平台请求应用服务器->应用服务器的`下一步处理器`，收到用户的输入码，返回`放音`动作（给用户播放最新优惠的音乐）
3. 平台执行`放音`动作完成，平台请求应用服务器->应用服务器的`下一步处理器`，返回`收码`动作(给用户播放欢迎或引导音，并收码)
4. 用户在手机上通过拨号按键输入另外一个手机号码，平台请求应用服务器->应用服务器的`下一步处理器`，应用服务收到用户的输入第二个手机号码，然后返回`IVR拨号`动作，呼叫这个手机
5. 呼叫第二个手机成功后，连接两个手机，让他们进行交流，直到超时或者其中一方挂机，平台收到挂断事件，平台请求应用服务器->应用服务器的`下一步处理器`
7. 应用服务返回呼叫结束 IVR

上面流程中主要包含以下动作：`放音`，`收码`，`IVR拨号` 。下面的章节，将对这三个动作进行解析。
